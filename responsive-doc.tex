\documentclass{ltxdoc}

\usepackage[noautomatic]{responsive}
\usepackage{linebreaker}
\usepackage{fontspec}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{graphicx}
\usepackage{microtype}
\setmainfont{EB Garamond}
\usepackage{lipsum}
\title{The Responsive Package}
\author{Michal Hoftich\thanks{\url{michal.h21@gmail.com}}}
\NewDocElement[macrolike = false ,
toplevel = false,
idxtype
= key,
idxgroup = Package keys,
% printtype = \textit{key}
]{Key}{key}

\newcommand\printsize[1]{\csname #1\endcsname\par\noindent Sample\par}
\newcommand\showscale[2][.5\textwidth]{%
  \noindent\fbox{%
    \begin{minipage}{#1}
      \ResponsiveSetup{#2}
      \setsizes[34]{25}
      \printsize{huge}
      \printsize{LARGE}
      \printsize{Large}
      \printsize{large}
      \hrule
      \printsize{normalsize}
      \hrule
      \printsize{small}
      \printsize{footnotesize}
    \end{minipage}
  }
    \ifx\relax#2\relax Default parameters\else\texttt{#2}\fi\hfill\null
}
\makeindex

\begin{document}
\maketitle
\begin{abstract}
Responsive design aims to display text and other design elements well on
variety of outputs, including electronic devices or various paper sizes.
It originated on the Web, where it uses Cascading Style Sheets to change 
design elements. 

This package tries to achieve similar result with \LaTeX. The main aim is to 
support output of multiple editions of one document with 
readable font sizes regardless of the physical size of the produced PDF,
from smartphones or e-ink readers to printed A4.
\end{abstract}
\tableofcontents

\section{Introduction}

This package aims to facilitate the creation of documents for multiple output
formats, such as various page sizes, e-book readers, or even mobile phones.

One of the issues that needs to be addressed is setting the correct font size
for readability. The default font size in LaTeX is 10 points, regardless of the
page size. This is an appropriate font size for A5 format pages. For A4 format,
the font size should be larger, while it may be smaller for smaller displays of
e-readers and mobile phones. Similarly, we can adjust the line spacing, which
also affects text readability depending on the font size and page size.

Web browsers face a similar problem as they must display text on both large PC
monitors and smaller displays of laptops, tablets, and mobile phones. The
solution they use is called \textit{responsive design}.

Responsive design is a method of web design that allows flexible and dynamic
adaptation of the appearance and layout of page content to different display
devices. One of the key elements of responsive design is a flexible structure
that enables adjusting the size of elements on the page to the display device.

Another important element is media queries. These allow defining rules based on
the properties of the display device, such as screen width and height or output
type (paper, display). Thanks to these rules, the same page code can be
well-displayed on both large monitors and mobile devices or when printing. 

The Responsive package is inspired by these principles. Its main function
is to set the font size based on the page size and the approximate number of
characters that should fit on the page (see figure~\ref{fig:example}). It also adjusts the typographic scale
(influencing font size, for example, in headings or footnotes), line height,
and supports a simple version of media queries.


\section{Features}


\subsection{Fitting Font Size to the Page Size}

Regardless of the width of the page, there is a certain range of the number of
characters that should be displayed on average per line of text to ensure good
readability. With a larger number of characters, the reader may have difficulty
quickly moving to the next line, while shorter lines may lead to skipping
lines. 

The Responsive package automatically sets the width of the text to a chosen number of characters.
Figure~\ref{fig:example} shows a difference in the font size in two
different text widths.


\begin{figure}[htbp]
  \caption{Example of changing font size based on the width of the text block:}\label{fig:example}
\begin{subfigure}[t]{0.45\textwidth}
\fbox{%
\begin{minipage}{4cm}
\ResponsiveSetup{}
\setsizes{}

\lipsum[1]

\end{minipage}}
\caption{Text width 4cm}
\end{subfigure}
% \hfill
\begin{subfigure}[t]{0.45\textwidth}
\fbox{%
\begin{minipage}{6cm}
\ResponsiveSetup{}
\setsizes{}

% \lipsum[1]
Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Ut purus elit,
vestibulum ut, placerat ac, adipiscing vitae, felis. Curabitur dictum gravida
mauris. Nam arcu libero, nonummy eget, consectetuer id, vulputate a,
magna. Donec vehicula augue eu neque. Pellentesque habitant morbi
tristique senectus et netus et malesuada fames ac turpis egestas. Mauris
ut leo. Cras viverra metus rhoncus sem. Nulla et lectus vestibulum urna
fringilla ultrices. Phasellus eu tellus sit amet tortor gravida placerat. Integer
sapien est, iaculis in, pretium quis, viverra ac, nunc.

\end{minipage}}
\caption{Text width 6cm}
\end{subfigure}
\end{figure}


\subsection{Typographic Scale}

The typographic scale is a set of predetermined font sizes used to establish a
consistent visual style for a document or website. These sizes are typically
expressed in point units and progressively increase or decrease by a specific
interval along the scale.

A typographic scale may include sizes for headings, footnotes, and body text.
Proper use of a typographic scale helps create a visual hierarchy that enhances
the readability and aesthetic appeal of the text. 

In \LaTeX, the typographic scale is accessible through commands such as \verb|\large|,
\verb|\huge|, or \verb|\scriptsize|. Each of these commands is one interval
away from the previous size. The default scale in the Responsive package
closely aligns with the scale used in \LaTeX\ is referred to as tetratonic.
The package also offers additional scales described in the
article, such as the golden scale based on the golden ratio. 
See Figure~\ref{fig:scale} for differences between the default scale and scale based on the 
golden ratio.


\begin{figure}[htbp]
  \caption{Sample of Typographic Scales (the default font size is highlighted with lines)}\label{fig:scale}
  \begin{subfigure}[b]{0.45\textwidth}
\fbox{%
\begin{minipage}{5cm}
\setsizes{45}

\showscale{}

\end{minipage}}
\caption{Default scale}
\end{subfigure}
\begin{subfigure}[b]{0.45\textwidth}
% \begin{verbatim}
% \ResponsiveSetup{scale=golden}
% \end{verbatim}
\fbox{%
\begin{minipage}{5cm}
% \ResponsiveSetup{scale=golden}
\setsizes{45}

\showscale{scale=golden}

\end{minipage}}
\caption{Golden ratio scale}
\end{subfigure}
\end{figure}
% % https://spencermortensen.com/articles/typographic-scale/



% \showscale{}
% \showscale{scale=heptatonic}
% \showscale{scale=tritonic}
% \showscale{scale=golden}
% \showscale{scale=none,ratio=1.3,number=2}

\subsection{Line height}

In the default settings of \LaTeX, the line spacing is set to the font size
multiplied by a factor of 1.2. For different fonts and page sizes, a different
line spacing may be appropriate. Similarly, distinct values may be suitable for
the printed and electronic versions of the document. 

The Responsive package provides the option \verb|lineratio|, which allows you to change the line spacing
(Figure~\ref{fig:lineratio}).

\begin{figure}[htbp]
  \caption{Changing the line spacing by adjusting the value of \texttt{lineratio}.}\label{fig:lineratio}
  \begin{subfigure}[b]{0.45\textwidth}
\fbox{%
\begin{minipage}{5cm}
\ResponsiveSetup{lineratio=38}
\setsizes{65}

\lipsum[1]

\end{minipage}}
\caption{lineratio=38}
\end{subfigure}
\begin{subfigure}[b]{0.45\textwidth}
\fbox{%
\begin{minipage}{5cm}
\ResponsiveSetup{lineratio=34}
\setsizes{65}

\lipsum[1]

\end{minipage}}
\caption{lineratio=34}
\end{subfigure}
\end{figure}

% https://www.smashingmagazine.com/2020/07/css-techniques-legibility/

\subsection{Media Queries}

Media queries are a technique that allows web developers to dynamically adapt
the appearance and behavior of websites based on various device properties,
such as screen width and height, device orientation, color support, and more.
Thanks to these conditions, responsive and flexible websites can be created
that automatically adjust to different types and sizes of devices on which they
are displayed.

How can this technique be useful for \LaTeX\ package authors? They could, for
example, set the font size, line spacing, and other elements for specific page
dimensions. Once the user chooses the page size based on the device size for
which they want to compile the document, these elements are automatically
adjusted. For instance, a package author could define that if the width of the
text block is smaller than a certain dimension, fewer characters will be
displayed on each line compared to longer lines (Figure~\ref{fig:mediaquery}). 




\newcommand\mdtest{%
  \mediaquery{max-textwidth=4cm}
  {\ResponsiveSetup{lineratio=38}\setsizes{45}}
  {\ResponsiveSetup{lineratio=34}\setsizes{60}}
  \lipsum[1]
}

\begin{figure}[htbp]
  % \centering
  % \begin{subcaptionblock}{0.25\textwidth}
  \caption{Change number of characters and line spacing depending on the text width using Media queries}\label{fig:mediaquery}
  \begin{subcaptiongroup}
    \begin{minipage}{3.9cm}
      { \mdtest
        
      }
    \caption{Text width of 3.9cm with 45 characters}
    \end{minipage}
    \hfill
    % \hspace{2em}
    \begin{minipage}{6cm}
      { \mdtest 

      }
      \caption{Text width of 6cm with 60 characters}
    \end{minipage}
  \end{subcaptiongroup}
  % \end{subcaptionblock}
\end{figure}



\section{Package Options}

The following options can be passed as package uptions used in \cmd{\usepackage}, 
or later in the document using the \cmd{\ResponsiveSetup} command.

\medskip

\noindent \DescribeKey{characters} Set aproximate number of characters that should fit to a text line.

\noindent \DescribeKey{noautomatic}  Disable automatic setting of font sizes in the document. You can set them 
later using the \cmd{\setsizes} command.

\noindent \DescribeKey{scale} Select typographic scale

\noindent \DescribeKey{number} Number of steps before the scale reaches the next multiplication point.

\noindent \DescribeKey{ratio} 

\noindent \DescribeKey{lineratio} 

\noindent \DescribeKey{boxwidth} Width of line that is used for font size calculations in the \cmd{\setsizes} command.




\section{Commands}

\DescribeMacro\setsizes
\cmd\setsizes\oarg{xxx}\marg{characters per lines}

% \PrintIndex

\section{Troubleshooting}

Occasionally, you can run into issues caused by the change of font sizes. \LaTeX\ sets lot of parameters 
depending on the base font size. We try to recalculate them according to the new font size, but you can still
experience some issues, described in following subsections.

\subsection{Underfull \texttt{\textbackslash vbox} warning}

Ocasionally, you can get the following warning:

\begin{verbatim}
Underfull \vbox (badness 6412) has occurred while \output is active []
\end{verbatim}


this trick should fix vbox errors in the output routine. 
we calculate exact box for the font size, but often,
we would get error when a bigger font is used on the page,
for example in chapters

There are several 
  % source: https://tex.stackexchange.com/a/62318/2891
  \def\@textbottom{\vskip \z@ \@plus \resp_font_size \@minus \resp_font_size}
\section{Examples}

\end{document}
